<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
<link href="//netdna.bootstrapcdn.com/bootswatch/3.0.3/flatly/bootstrap.min.css" rel="stylesheet">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  $(function () {
  
    // 投稿ボタン押下
    $('#write').on('click', function() {
      socket.emit('msg', $('#userName').val() + 'さん：' + $('#msg').val());
      $('#msg').val('');
      return false;
    });

    // 退室ボタン押下
    $('#exit').on('click', function() {
      socket.emit('exit', $('#userName').val());
      location.href = '/';
    });
  
    // socket.ioの処理開始
    var socket = io.connect();

    // 入室
    socket.on('enter', function (data) {
      $('#thread').prepend(data + 'さんが入室しました。<br>');
    });

    // 退室
    socket.on('exit', function (data) {
      $('#thread').prepend(data + 'さんが退室しました。<br>');
    });

    // 投稿
    socket.on('msg', function (data) {
      $('#thread').prepend(data + '<br>');
    });
  });
</script>
<style>
.row {
  width: 500px;
  margin: 20px;
  font-family: Meiryo;
}
</style>
</head>
<body>
<form method="post" action="/">
  <div class="row">
    <h1>Node Chat Root</h1>
  </div>
  <div class="row">
    ログインユーザ：<%= userName %>さん
  </div>
  <input id="userName" type="hidden" value="<%= userName %>">
  <div class="row">
    <textarea id="msg" rows="4" class="form-control" placeholder="投稿文を入力してください"></textarea>
  </div>
  <div class="row">
    <input type="button" id="write" value="投稿" class="btn btn-info">
  </div>
  <div class="row">
    <div id="thread"></div>
  </div>
  <div class="row" style="margin-top:20px;">
    <input type="button" id="exit" value="退室する" class="btn btn-info">
  </div>
</form>
<div>
</body>
</html>